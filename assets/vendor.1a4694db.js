const C=Symbol("Comlink.proxy"),j=Symbol("Comlink.endpoint"),V=Symbol("Comlink.releaseProxy"),L=Symbol("Comlink.thrown"),b=r=>typeof r=="object"&&r!==null||typeof r=="function",D={canHandle:r=>b(r)&&r[C],serialize(r){const{port1:e,port2:n}=new MessageChannel;return N(r,e),[n,[n]]},deserialize(r){return r.start(),Y(r)}},I={canHandle:r=>b(r)&&L in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},O=new Map([["proxy",D],["throw",I]]);function N(r,e=self){e.addEventListener("message",function n(a){if(!a||!a.data)return;const{id:s,type:c,path:i}=Object.assign({path:[]},a.data),t=(a.data.argumentList||[]).map(A);let l;try{const f=i.slice(0,-1).reduce((y,h)=>y[h],r),v=i.reduce((y,h)=>y[h],r);switch(c){case"GET":l=v;break;case"SET":f[i.slice(-1)[0]]=A(a.data.value),l=!0;break;case"APPLY":l=v.apply(f,t);break;case"CONSTRUCT":{const y=new v(...t);l=X(y)}break;case"ENDPOINT":{const{port1:y,port2:h}=new MessageChannel;N(r,h),l=G(y,[y])}break;case"RELEASE":l=void 0;break;default:return}}catch(f){l={value:f,[L]:0}}Promise.resolve(l).catch(f=>({value:f,[L]:0})).then(f=>{const[v,y]=T(f);e.postMessage(Object.assign(Object.assign({},v),{id:s}),y),c==="RELEASE"&&(e.removeEventListener("message",n),H(e))})}),e.start&&e.start()}function W(r){return r.constructor.name==="MessagePort"}function H(r){W(r)&&r.close()}function Y(r,e){return R(r,[],e)}function z(r){if(r)throw new Error("Proxy has been released and is not useable")}function R(r,e=[],n=function(){}){let a=!1;const s=new Proxy(n,{get(c,i){if(z(a),i===V)return()=>P(r,{type:"RELEASE",path:e.map(t=>t.toString())}).then(()=>{H(r),a=!0});if(i==="then"){if(e.length===0)return{then:()=>s};const t=P(r,{type:"GET",path:e.map(l=>l.toString())}).then(A);return t.then.bind(t)}return R(r,[...e,i])},set(c,i,t){z(a);const[l,f]=T(t);return P(r,{type:"SET",path:[...e,i].map(v=>v.toString()),value:l},f).then(A)},apply(c,i,t){z(a);const l=e[e.length-1];if(l===j)return P(r,{type:"ENDPOINT"}).then(A);if(l==="bind")return R(r,e.slice(0,-1));const[f,v]=_(t);return P(r,{type:"APPLY",path:e.map(y=>y.toString()),argumentList:f},v).then(A)},construct(c,i){z(a);const[t,l]=_(i);return P(r,{type:"CONSTRUCT",path:e.map(f=>f.toString()),argumentList:t},l).then(A)}});return s}function U(r){return Array.prototype.concat.apply([],r)}function _(r){const e=r.map(T);return[e.map(n=>n[0]),U(e.map(n=>n[1]))]}const F=new WeakMap;function G(r,e){return F.set(r,e),r}function X(r){return Object.assign(r,{[C]:!0})}function T(r){for(const[e,n]of O)if(n.canHandle(r)){const[a,s]=n.serialize(r);return[{type:"HANDLER",name:e,value:a},s]}return[{type:"RAW",value:r},F.get(r)||[]]}function A(r){switch(r.type){case"HANDLER":return O.get(r.name).deserialize(r.value);case"RAW":return r.value}}function P(r,e,n){return new Promise(a=>{const s=$();r.addEventListener("message",function c(i){!i.data||!i.data.id||i.data.id!==s||(r.removeEventListener("message",c),a(i.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:s},e),n)})}function $(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var S=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function K(){var r=new S(16);return S!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Z(r,e,n){var a=e[0],s=e[1],c=e[2],i=e[3],t=e[4],l=e[5],f=e[6],v=e[7],y=e[8],h=e[9],p=e[10],w=e[11],E=e[12],M=e[13],x=e[14],k=e[15],g=n[0],d=n[1],m=n[2],o=n[3];return r[0]=g*a+d*t+m*y+o*E,r[1]=g*s+d*l+m*h+o*M,r[2]=g*c+d*f+m*p+o*x,r[3]=g*i+d*v+m*w+o*k,g=n[4],d=n[5],m=n[6],o=n[7],r[4]=g*a+d*t+m*y+o*E,r[5]=g*s+d*l+m*h+o*M,r[6]=g*c+d*f+m*p+o*x,r[7]=g*i+d*v+m*w+o*k,g=n[8],d=n[9],m=n[10],o=n[11],r[8]=g*a+d*t+m*y+o*E,r[9]=g*s+d*l+m*h+o*M,r[10]=g*c+d*f+m*p+o*x,r[11]=g*i+d*v+m*w+o*k,g=n[12],d=n[13],m=n[14],o=n[15],r[12]=g*a+d*t+m*y+o*E,r[13]=g*s+d*l+m*h+o*M,r[14]=g*c+d*f+m*p+o*x,r[15]=g*i+d*v+m*w+o*k,r}function q(r,e,n){var a=n[0],s=n[1],c=n[2],i,t,l,f,v,y,h,p,w,E,M,x;return e===r?(r[12]=e[0]*a+e[4]*s+e[8]*c+e[12],r[13]=e[1]*a+e[5]*s+e[9]*c+e[13],r[14]=e[2]*a+e[6]*s+e[10]*c+e[14],r[15]=e[3]*a+e[7]*s+e[11]*c+e[15]):(i=e[0],t=e[1],l=e[2],f=e[3],v=e[4],y=e[5],h=e[6],p=e[7],w=e[8],E=e[9],M=e[10],x=e[11],r[0]=i,r[1]=t,r[2]=l,r[3]=f,r[4]=v,r[5]=y,r[6]=h,r[7]=p,r[8]=w,r[9]=E,r[10]=M,r[11]=x,r[12]=i*a+v*s+w*c+e[12],r[13]=t*a+y*s+E*c+e[13],r[14]=l*a+h*s+M*c+e[14],r[15]=f*a+p*s+x*c+e[15]),r}function u(r,e,n){var a=n[0],s=n[1],c=n[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*s,r[5]=e[5]*s,r[6]=e[6]*s,r[7]=e[7]*s,r[8]=e[8]*c,r[9]=e[9]*c,r[10]=e[10]*c,r[11]=e[11]*c,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function rr(r,e,n){var a=Math.sin(n),s=Math.cos(n),c=e[4],i=e[5],t=e[6],l=e[7],f=e[8],v=e[9],y=e[10],h=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=c*s+f*a,r[5]=i*s+v*a,r[6]=t*s+y*a,r[7]=l*s+h*a,r[8]=f*s-c*a,r[9]=v*s-i*a,r[10]=y*s-t*a,r[11]=h*s-l*a,r}function er(r,e,n){var a=Math.sin(n),s=Math.cos(n),c=e[0],i=e[1],t=e[2],l=e[3],f=e[8],v=e[9],y=e[10],h=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=c*s-f*a,r[1]=i*s-v*a,r[2]=t*s-y*a,r[3]=l*s-h*a,r[8]=c*a+f*s,r[9]=i*a+v*s,r[10]=t*a+y*s,r[11]=l*a+h*s,r}function nr(r,e){var n=e[0],a=e[1],s=e[2],c=e[3],i=n+n,t=a+a,l=s+s,f=n*i,v=a*i,y=a*t,h=s*i,p=s*t,w=s*l,E=c*i,M=c*t,x=c*l;return r[0]=1-y-w,r[1]=v+x,r[2]=h-M,r[3]=0,r[4]=v-x,r[5]=1-f-w,r[6]=p+E,r[7]=0,r[8]=h+M,r[9]=p-E,r[10]=1-f-y,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Q(r,e,n,a,s,c,i){var t=1/(e-n),l=1/(a-s),f=1/(c-i);return r[0]=-2*t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*l,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(e+n)*t,r[13]=(s+a)*l,r[14]=(i+c)*f,r[15]=1,r}var ar=Q;function B(){var r=new S(3);return S!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function sr(r,e,n){var a=e[0],s=e[1],c=e[2],i=n[3]*a+n[7]*s+n[11]*c+n[15];return i=i||1,r[0]=(n[0]*a+n[4]*s+n[8]*c+n[12])/i,r[1]=(n[1]*a+n[5]*s+n[9]*c+n[13])/i,r[2]=(n[2]*a+n[6]*s+n[10]*c+n[14])/i,r}(function(){var r=B();return function(e,n,a,s,c,i){var t,l;for(n||(n=3),a||(a=0),s?l=Math.min(s*n+a,e.length):l=e.length,t=a;t<l;t+=n)r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],c(r,r,i),e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2];return e}})();function J(){var r=new S(2);return S!=Float32Array&&(r[0]=0,r[1]=0),r}function tr(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r}function ir(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r}function cr(r,e,n,a){var s=e[0]-n[0],c=e[1]-n[1],i=Math.sin(a),t=Math.cos(a);return r[0]=s*t-c*i+n[0],r[1]=s*i+c*t+n[1],r}(function(){var r=J();return function(e,n,a,s,c,i){var t,l;for(n||(n=2),a||(a=0),s?l=Math.min(s*n+a,e.length):l=e.length,t=a;t<l;t+=n)r[0]=e[t],r[1]=e[t+1],c(r,r,i),e[t]=r[0],e[t+1]=r[1];return e}})();export{sr as a,er as b,K as c,cr as d,tr as e,nr as f,ir as g,Z as m,ar as o,X as p,rr as r,u as s,q as t,Y as w};
