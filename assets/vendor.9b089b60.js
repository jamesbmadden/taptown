var q=Object.defineProperty,ee=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var j=(e,r,n)=>r in e?q(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,F=(e,r)=>{for(var n in r||(r={}))ne.call(r,n)&&j(e,n,r[n]);if(N)for(var n of N(r))te.call(r,n)&&j(e,n,r[n]);return e},W=(e,r)=>ee(e,re(r));const V=Symbol("Comlink.proxy"),se=Symbol("Comlink.endpoint"),ae=Symbol("Comlink.releaseProxy"),I=Symbol("Comlink.thrown"),H=e=>typeof e=="object"&&e!==null||typeof e=="function",ie={canHandle:e=>H(e)&&e[V],serialize(e){const{port1:r,port2:n}=new MessageChannel;return Y(e,r),[n,[n]]},deserialize(e){return e.start(),fe(e)}},ce={canHandle:e=>H(e)&&I in e,serialize({value:e}){let r;return e instanceof Error?r={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:r={isError:!1,value:e},[r,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},_=new Map([["proxy",ie],["throw",ce]]);function Y(e,r=self){r.addEventListener("message",function n(t){if(!t||!t.data)return;const{id:s,type:i,path:a}=Object.assign({path:[]},t.data),c=(t.data.argumentList||[]).map(D);let o;try{const f=a.slice(0,-1).reduce((l,y)=>l[y],e),d=a.reduce((l,y)=>l[y],e);switch(i){case"GET":o=d;break;case"SET":f[a.slice(-1)[0]]=D(t.data.value),o=!0;break;case"APPLY":o=d.apply(f,c);break;case"CONSTRUCT":{const l=new d(...c);o=ye(l)}break;case"ENDPOINT":{const{port1:l,port2:y}=new MessageChannel;Y(e,y),o=de(l,[l])}break;case"RELEASE":o=void 0;break;default:return}}catch(f){o={value:f,[I]:0}}Promise.resolve(o).catch(f=>({value:f,[I]:0})).then(f=>{const[d,l]=T(f);r.postMessage(Object.assign(Object.assign({},d),{id:s}),l),i==="RELEASE"&&(r.removeEventListener("message",n),U(r))})}),r.start&&r.start()}function oe(e){return e.constructor.name==="MessagePort"}function U(e){oe(e)&&e.close()}function fe(e,r){return S(e,[],r)}function P(e){if(e)throw new Error("Proxy has been released and is not useable")}function S(e,r=[],n=function(){}){let t=!1;const s=new Proxy(n,{get(i,a){if(P(t),a===ae)return()=>x(e,{type:"RELEASE",path:r.map(c=>c.toString())}).then(()=>{U(e),t=!0});if(a==="then"){if(r.length===0)return{then:()=>s};const c=x(e,{type:"GET",path:r.map(o=>o.toString())}).then(D);return c.then.bind(c)}return S(e,[...r,a])},set(i,a,c){P(t);const[o,f]=T(c);return x(e,{type:"SET",path:[...r,a].map(d=>d.toString()),value:o},f).then(D)},apply(i,a,c){P(t);const o=r[r.length-1];if(o===se)return x(e,{type:"ENDPOINT"}).then(D);if(o==="bind")return S(e,r.slice(0,-1));const[f,d]=$(c);return x(e,{type:"APPLY",path:r.map(l=>l.toString()),argumentList:f},d).then(D)},construct(i,a){P(t);const[c,o]=$(a);return x(e,{type:"CONSTRUCT",path:r.map(f=>f.toString()),argumentList:c},o).then(D)}});return s}function le(e){return Array.prototype.concat.apply([],e)}function $(e){const r=e.map(T);return[r.map(n=>n[0]),le(r.map(n=>n[1]))]}const G=new WeakMap;function de(e,r){return G.set(e,r),e}function ye(e){return Object.assign(e,{[V]:!0})}function T(e){for(const[r,n]of _)if(n.canHandle(e)){const[t,s]=n.serialize(e);return[{type:"HANDLER",name:r,value:t},s]}return[{type:"RAW",value:e},G.get(e)||[]]}function D(e){switch(e.type){case"HANDLER":return _.get(e.name).deserialize(e.value);case"RAW":return e.value}}function x(e,r,n){return new Promise(t=>{const s=he();e.addEventListener("message",function i(a){!a.data||!a.data.id||a.data.id!==s||(e.removeEventListener("message",i),t(a.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:s},r),n)})}function he(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var A=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function Ie(){var e=new A(16);return A!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Se(e,r,n){var t=r[0],s=r[1],i=r[2],a=r[3],c=r[4],o=r[5],f=r[6],d=r[7],l=r[8],y=r[9],p=r[10],w=r[11],E=r[12],u=r[13],M=r[14],L=r[15],h=n[0],g=n[1],m=n[2],v=n[3];return e[0]=h*t+g*c+m*l+v*E,e[1]=h*s+g*o+m*y+v*u,e[2]=h*i+g*f+m*p+v*M,e[3]=h*a+g*d+m*w+v*L,h=n[4],g=n[5],m=n[6],v=n[7],e[4]=h*t+g*c+m*l+v*E,e[5]=h*s+g*o+m*y+v*u,e[6]=h*i+g*f+m*p+v*M,e[7]=h*a+g*d+m*w+v*L,h=n[8],g=n[9],m=n[10],v=n[11],e[8]=h*t+g*c+m*l+v*E,e[9]=h*s+g*o+m*y+v*u,e[10]=h*i+g*f+m*p+v*M,e[11]=h*a+g*d+m*w+v*L,h=n[12],g=n[13],m=n[14],v=n[15],e[12]=h*t+g*c+m*l+v*E,e[13]=h*s+g*o+m*y+v*u,e[14]=h*i+g*f+m*p+v*M,e[15]=h*a+g*d+m*w+v*L,e}function Te(e,r,n){var t=n[0],s=n[1],i=n[2],a,c,o,f,d,l,y,p,w,E,u,M;return r===e?(e[12]=r[0]*t+r[4]*s+r[8]*i+r[12],e[13]=r[1]*t+r[5]*s+r[9]*i+r[13],e[14]=r[2]*t+r[6]*s+r[10]*i+r[14],e[15]=r[3]*t+r[7]*s+r[11]*i+r[15]):(a=r[0],c=r[1],o=r[2],f=r[3],d=r[4],l=r[5],y=r[6],p=r[7],w=r[8],E=r[9],u=r[10],M=r[11],e[0]=a,e[1]=c,e[2]=o,e[3]=f,e[4]=d,e[5]=l,e[6]=y,e[7]=p,e[8]=w,e[9]=E,e[10]=u,e[11]=M,e[12]=a*t+d*s+w*i+r[12],e[13]=c*t+l*s+E*i+r[13],e[14]=o*t+y*s+u*i+r[14],e[15]=f*t+p*s+M*i+r[15]),e}function Ce(e,r,n){var t=n[0],s=n[1],i=n[2];return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*s,e[5]=r[5]*s,e[6]=r[6]*s,e[7]=r[7]*s,e[8]=r[8]*i,e[9]=r[9]*i,e[10]=r[10]*i,e[11]=r[11]*i,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function ke(e,r,n){var t=Math.sin(n),s=Math.cos(n),i=r[4],a=r[5],c=r[6],o=r[7],f=r[8],d=r[9],l=r[10],y=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=i*s+f*t,e[5]=a*s+d*t,e[6]=c*s+l*t,e[7]=o*s+y*t,e[8]=f*s-i*t,e[9]=d*s-a*t,e[10]=l*s-c*t,e[11]=y*s-o*t,e}function Be(e,r,n){var t=Math.sin(n),s=Math.cos(n),i=r[0],a=r[1],c=r[2],o=r[3],f=r[8],d=r[9],l=r[10],y=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*s-f*t,e[1]=a*s-d*t,e[2]=c*s-l*t,e[3]=o*s-y*t,e[8]=i*t+f*s,e[9]=a*t+d*s,e[10]=c*t+l*s,e[11]=o*t+y*s,e}function Re(e,r){var n=r[0],t=r[1],s=r[2],i=r[3],a=n+n,c=t+t,o=s+s,f=n*a,d=t*a,l=t*c,y=s*a,p=s*c,w=s*o,E=i*a,u=i*c,M=i*o;return e[0]=1-l-w,e[1]=d+M,e[2]=y-u,e[3]=0,e[4]=d-M,e[5]=1-f-w,e[6]=p+E,e[7]=0,e[8]=y+u,e[9]=p-E,e[10]=1-f-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ge(e,r,n,t,s,i,a){var c=1/(r-n),o=1/(t-s),f=1/(i-a);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(r+n)*c,e[13]=(s+t)*o,e[14]=(a+i)*f,e[15]=1,e}var Oe=ge;function me(){var e=new A(3);return A!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ze(e,r,n){var t=r[0],s=r[1],i=r[2],a=n[3]*t+n[7]*s+n[11]*i+n[15];return a=a||1,e[0]=(n[0]*t+n[4]*s+n[8]*i+n[12])/a,e[1]=(n[1]*t+n[5]*s+n[9]*i+n[13])/a,e[2]=(n[2]*t+n[6]*s+n[10]*i+n[14])/a,e}(function(){var e=me();return function(r,n,t,s,i,a){var c,o;for(n||(n=3),t||(t=0),s?o=Math.min(s*n+t,r.length):o=r.length,c=t;c<o;c+=n)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],i(e,e,a),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2];return r}})();function ve(){var e=new A(2);return A!=Float32Array&&(e[0]=0,e[1]=0),e}function Ne(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e}function je(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e}function Fe(e,r,n,t){var s=r[0]-n[0],i=r[1]-n[1],a=Math.sin(t),c=Math.cos(t);return e[0]=s*c-i*a+n[0],e[1]=s*a+i*c+n[1],e}(function(){var e=ve();return function(r,n,t,s,i,a){var c,o;for(n||(n=2),t||(t=0),s?o=Math.min(s*n+t,r.length):o=r.length,c=t;c<o;c+=n)e[0]=r[c],e[1]=r[c+1],i(e,e,a),r[c]=e[0],r[c+1]=e[1];return r}})();const pe=(e,r)=>r.some(n=>e instanceof n);let K,X;function we(){return K||(K=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ee(){return X||(X=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Q=new WeakMap,C=new WeakMap,J=new WeakMap,k=new WeakMap,B=new WeakMap;function ue(e){const r=new Promise((n,t)=>{const s=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{n(b(e.result)),s()},a=()=>{t(e.error),s()};e.addEventListener("success",i),e.addEventListener("error",a)});return r.then(n=>{n instanceof IDBCursor&&Q.set(n,e)}).catch(()=>{}),B.set(r,e),r}function Me(e){if(C.has(e))return;const r=new Promise((n,t)=>{const s=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{t(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});C.set(e,r)}let R={get(e,r,n){if(e instanceof IDBTransaction){if(r==="done")return C.get(e);if(r==="objectStoreNames")return e.objectStoreNames||J.get(e);if(r==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return b(e[r])},set(e,r,n){return e[r]=n,!0},has(e,r){return e instanceof IDBTransaction&&(r==="done"||r==="store")?!0:r in e}};function be(e){R=e(R)}function De(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(r,...n){const t=e.call(O(this),r,...n);return J.set(t,r.sort?r.sort():[r]),b(t)}:Ee().includes(e)?function(...r){return e.apply(O(this),r),b(Q.get(this))}:function(...r){return b(e.apply(O(this),r))}}function xe(e){return typeof e=="function"?De(e):(e instanceof IDBTransaction&&Me(e),pe(e,we())?new Proxy(e,R):e)}function b(e){if(e instanceof IDBRequest)return ue(e);if(k.has(e))return k.get(e);const r=xe(e);return r!==e&&(k.set(e,r),B.set(r,e)),r}const O=e=>B.get(e);function We(e,r,{blocked:n,upgrade:t,blocking:s,terminated:i}={}){const a=indexedDB.open(e,r),c=b(a);return t&&a.addEventListener("upgradeneeded",o=>{t(b(a.result),o.oldVersion,o.newVersion,b(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),c.then(o=>{i&&o.addEventListener("close",()=>i()),s&&o.addEventListener("versionchange",()=>s())}).catch(()=>{}),c}const Ae=["get","getKey","getAll","getAllKeys","count"],Le=["put","add","delete","clear"],z=new Map;function Z(e,r){if(!(e instanceof IDBDatabase&&!(r in e)&&typeof r=="string"))return;if(z.get(r))return z.get(r);const n=r.replace(/FromIndex$/,""),t=r!==n,s=Le.includes(n);if(!(n in(t?IDBIndex:IDBObjectStore).prototype)||!(s||Ae.includes(n)))return;const i=async function(a,...c){const o=this.transaction(a,s?"readwrite":"readonly");let f=o.store;return t&&(f=f.index(c.shift())),(await Promise.all([f[n](...c),s&&o.done]))[0]};return z.set(r,i),i}be(e=>W(F({},e),{get:(r,n,t)=>Z(r,n)||e.get(r,n,t),has:(r,n)=>!!Z(r,n)||e.has(r,n)}));export{ze as a,Be as b,Ie as c,Fe as d,Ne as e,Re as f,je as g,We as h,Se as m,Oe as o,ye as p,ke as r,Ce as s,Te as t,fe as w};
