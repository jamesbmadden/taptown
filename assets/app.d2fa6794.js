var dt=Object.defineProperty;var ft=(t,a,i)=>a in t?dt(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i;var m=(t,a,i)=>(ft(t,typeof a!="symbol"?a+"":a,i),i);import{c as M,s as g,f as ut,m as lt,t as _,a as ht,r as B,b as U,d as W,e as mt,g as xt,w as D,p as V,o as wt}from"./vendor.1a4694db.js";const pt=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const e of r)if(e.type==="childList")for(const f of e.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function i(r){const e={};return r.integrity&&(e.integrity=r.integrity),r.referrerpolicy&&(e.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?e.credentials="include":r.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function n(r){if(r.ep)return;r.ep=!0;const e=i(r);fetch(r.href,e)}};pt();var Tt=`attribute vec4 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat4 uModelViewMatrix;
uniform mat4 uProjectionMatrix;

varying highp vec2 vTextureCoord;

void main(void) {
  gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;
  vTextureCoord = aTextureCoord;
}`,_t=`varying highp vec2 vTextureCoord;
uniform sampler2D uTexture;

void main(void) {

  gl_FragColor = texture2D(uTexture, vTextureCoord);
  
}`;function vt(t,a){return new Promise((i,n)=>{const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const e=new Image;e.onload=()=>{t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),N(e.width)&&N(e.height)?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),i(r)},e.src=a})}function N(t){return(t&t-1)==0}function d(t,a){return new Promise(async(i,n)=>{const e=await(await fetch(a)).json(),f=e.scenes[e.scene],s=await(await fetch(e.buffers[0].uri)).blob();let h=[...f.nodes],l=0,p=[],v=[],b=[];for(;l<h.length;){let Q=v.length/3;const x=e.nodes[h[l]];if(x.children&&h.push(...x.children),x.mesh!==void 0){let R=M();if(x.scale&&g(R,R,x.scale),x.rotation){const w=M();ut(w,x.rotation),lt(R,R,w)}x.translation&&_(R,R,x.translation);const L=e.meshes[x.mesh].primitives[0],K=L.indices,J=e.accessors[K],F=e.bufferViews[J.bufferView],tt=s.slice(F.byteOffset,F.byteOffset+F.byteLength),et=new Int16Array(await tt.arrayBuffer());p.push(...et.map(w=>w+Q));const rt=L.attributes.POSITION,at=e.accessors[rt],C=e.bufferViews[at.bufferView],ot=s.slice(C.byteOffset,C.byteOffset+C.byteLength),P=new Float32Array(await ot.arrayBuffer());for(let w=0;w<P.length;w+=3){let X=[P[w],P[w+1],P[w+2]];ht(X,X,R),v.push(...X)}const it=L.attributes.TEXCOORD_0,nt=e.accessors[it],S=e.bufferViews[nt.bufferView],st=s.slice(S.byteOffset,S.byteOffset+S.byteLength),ct=new Float32Array(await st.arrayBuffer());b.push(...ct)}l++}const $=await vt(t,e.images[0].uri),I=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,I),t.bufferData(t.ARRAY_BUFFER,new Float32Array(v),t.STATIC_DRAW);const Y=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,Y),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(p),t.STATIC_DRAW);const O=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,O),t.bufferData(t.ARRAY_BUFFER,new Float32Array(b),t.STATIC_DRAW),i({buffers:{index:Y,vertex:I,texCoords:O},indexCount:p.length,texture:$})})}var Rt="/taptown/assets/Road-x.25087994.gltf",Mt="/taptown/assets/Road-right.05535041.gltf",bt="/taptown/assets/Road-left.e4d57c46.gltf",Et="/taptown/assets/Road-y.43b84893.gltf",At="/taptown/assets/Road-up.f33fbfbe.gltf",Pt="/taptown/assets/Road-down.3aa34828.gltf",yt="/taptown/assets/Road-cross.c0149426.gltf",Lt="/taptown/assets/Road-upleft.8e8e8992.gltf",Ft="/taptown/assets/Road-leftdown.43e4587d.gltf",Ct="/taptown/assets/Road-downright.2ee19715.gltf",St="/taptown/assets/Road-rightup.f9b3a2d6.gltf",Xt="/taptown/assets/Road-T.dd27be2f.gltf",Bt="/taptown/assets/Road-l-.8fa437e2.gltf",Ut="/taptown/assets/Road--l.cec3388c.gltf",Dt="/taptown/assets/Road-_l_.04dac8e2.gltf",It="/taptown/assets/Road-single.f2299542.gltf",Yt="/taptown/assets/outofbounds.54610d6d.gltf",Ot="/taptown/assets/Cafe.89231c7b.gltf";const c=[null];let j=!1;async function gt(t){c[1]=await d(t,Rt),c[2]=await d(t,Mt),c[3]=await d(t,bt),c[4]=await d(t,Et),c[5]=await d(t,At),c[6]=await d(t,Pt),c[7]=await d(t,yt),c[8]=await d(t,Lt),c[9]=await d(t,Ft),c[10]=await d(t,Ct),c[11]=await d(t,St),c[12]=await d(t,Xt),c[13]=await d(t,Bt),c[14]=await d(t,Ut),c[15]=await d(t,Dt),c[16]=await d(t,It),c[254]=await d(t,Yt),c[255]=await d(t,Ot),j=!0}function z(t,a,[i,n],r,e,f){if(!j)throw"Models aren't loaded!";const u=c[a];if(!u)return;const s=M();_(s,f,[i*2,0,n*2]);{const h=3,l=t.FLOAT,p=!1,v=0,b=0;t.bindBuffer(t.ARRAY_BUFFER,u.buffers.vertex),t.vertexAttribPointer(r.attribLocations.vertexPosition,h,l,p,v,b),t.enableVertexAttribArray(r.attribLocations.vertexPosition)}{const h=2,l=t.FLOAT,p=!1,v=0,b=0;t.bindBuffer(t.ARRAY_BUFFER,u.buffers.texCoords),t.vertexAttribPointer(r.attribLocations.textureCoordPosition,h,l,p,v,b),t.enableVertexAttribArray(r.attribLocations.textureCoordPosition)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u.buffers.index),t.useProgram(r.program),t.uniformMatrix4fv(r.uniformLocations.projectionMatrix,!1,e),t.uniformMatrix4fv(r.uniformLocations.modelViewMatrix,!1,s),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,u.texture),t.uniform1i(r.uniformLocations.texture,0),t.drawElements(t.TRIANGLES,u.indexCount,t.UNSIGNED_SHORT,0)}class Wt{constructor(){m(this,"x",0);m(this,"z",0);m(this,"_pointerDown",!1);m(this,"_velocityX",0);m(this,"_velocityY",0);m(this,"_pixelToTileX");m(this,"_pixelToTileZ");m(this,"_prevPointerX");m(this,"_prevPointerY");m(this,"_inFocusMode",!1);m(this,"cameraMatrix",M());_(this.cameraMatrix,this.cameraMatrix,[0,1,-3]),B(this.cameraMatrix,this.cameraMatrix,45*Math.PI/180),U(this.cameraMatrix,this.cameraMatrix,45*Math.PI/180),document.addEventListener("pointerdown",a=>{this._pointerDown=!0,this._prevPointerX=a.clientX,this._prevPointerY=a.clientY}),document.addEventListener("pointerup",()=>this._pointerDown=!1),document.addEventListener("pointermove",a=>{this._pointerDown&&(this._moveCamera(a.clientX-this._prevPointerX,a.clientY-this._prevPointerY),this._velocityX=a.clientX-this._prevPointerX,this._velocityY=a.clientY-this._prevPointerY),this._prevPointerX=a.clientX,this._prevPointerY=a.clientY})}_moveCamera(a,i){if(this._inFocusMode)return;const n=a/this._pixelToTileX,r=i/this._pixelToTileZ*1.425,e=[n,r];W(e,e,[0,0],45*Math.PI/180),this.x-=e[0],this.z-=e[1],_(this.cameraMatrix,this.cameraMatrix,[e[0],0,e[1]])}setPixelToTileRatio(a,i){this._pixelToTileX=a,this._pixelToTileZ=i}update(a){let i=a/16.66667;this._pointerDown||(this._velocityX=Math.floor(Math.abs(this._velocityX)/10.25*i)*Math.sign(this._velocityX)*10*i,this._velocityY=Math.floor(Math.abs(this._velocityY)/10.25*i)*Math.sign(this._velocityY)*10*i,this._moveCamera(this._velocityX,this._velocityY))}enterFocus([a,i]){this._inFocusMode=!0;const n=Date.now(),r=()=>{let e=(Date.now()-n)/1e3;e>1&&(e=1);const f=45*(1-e)+15*e,u=-this.x*(1-e)+-a*2*e,s=-this.z*(1-e)+-a*2*e,h=1+e;this.cameraMatrix=M(),_(this.cameraMatrix,this.cameraMatrix,[0,1,-3]),B(this.cameraMatrix,this.cameraMatrix,f*Math.PI/180),U(this.cameraMatrix,this.cameraMatrix,f*Math.PI/180),g(this.cameraMatrix,this.cameraMatrix,[h,h,h]),_(this.cameraMatrix,this.cameraMatrix,[u,0,s]),e<1&&requestAnimationFrame(r)};requestAnimationFrame(r)}exitFocus(){this.cameraMatrix=M(),_(this.cameraMatrix,this.cameraMatrix,[0,1,-3]),B(this.cameraMatrix,this.cameraMatrix,45*Math.PI/180),U(this.cameraMatrix,this.cameraMatrix,45*Math.PI/180),_(this.cameraMatrix,this.cameraMatrix,[-this.x,0,-this.z]),this._inFocusMode=!1}}const Vt=document.querySelector(".money"),Nt=document.querySelector(".population");function jt(t){Vt.textContent=`$${t.money}`,Nt.textContent=`${t.population}`}function zt(){return new Worker("/taptown/assets/ambient.6d469442.js",{type:"module"})}function Ht(){return new Worker("/taptown/assets/buildings.8e47e127.js",{type:"module"})}function kt(){return new Worker("/taptown/assets/people.9ab39b39.js",{type:"module"})}let H,k;const E=document.getElementsByTagName("canvas")[0];let A=2*(innerWidth/200),y=2*(innerHeight/200),G,T=new Wt;window.camera=T;E.width=innerWidth;E.height=innerHeight;let q=innerWidth/A,Z=innerHeight/y;T.setPixelToTileRatio(q,Z);const o=E.getContext("webgl");window.addEventListener("resize",()=>{E.width=innerWidth,E.height=innerHeight,A=2*(innerWidth/200),y=2*(innerHeight/200);let t=innerWidth/A,a=innerHeight/y;T.setPixelToTileRatio(t,a)});E.addEventListener("click",t=>{const a=t.clientX/q/2,i=t.clientY/Z/2*1.425,n=[a,i];W(n,n,[0,0],45*Math.PI/180);const r=[T.x/2+3.62,T.z/2-2.62];mt(n,n,r),xt(n,n)});Gt();async function Gt(){const t=D(new zt);t.log();const a=D(new Ht);a.log();const i=D(new kt);i.log(),await new t,H=await new a,await H.setCallback(V(s=>{G=s})),k=await new i,await k.setCallback(V(s=>{jt(s)}));const n=o.createShader(o.VERTEX_SHADER);o.shaderSource(n,Tt),o.compileShader(n);const r=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(r,_t),o.compileShader(r),!o.getShaderParameter(n,o.COMPILE_STATUS))return alert("An error occurred compiling the vert shaders: "+o.getShaderInfoLog(n)),o.deleteShader(n),null;if(!o.getShaderParameter(r,o.COMPILE_STATUS))return alert("An error occurred compiling the frag shaders: "+o.getShaderInfoLog(r)),o.deleteShader(r),null;const e=o.createProgram();if(o.attachShader(e,n),o.attachShader(e,r),o.linkProgram(e),!o.getProgramParameter(e,o.LINK_STATUS))return alert("Unable to initialize the shader program: "+o.getProgramInfoLog(e)),null;const f={program:e,attribLocations:{vertexPosition:o.getAttribLocation(e,"aVertexPosition"),textureCoordPosition:o.getAttribLocation(e,"aTextureCoord")},uniformLocations:{projectionMatrix:o.getUniformLocation(e,"uProjectionMatrix"),modelViewMatrix:o.getUniformLocation(e,"uModelViewMatrix"),texture:o.getUniformLocation(e,"uTexture")}};await gt(o);const u=s=>{qt(f),requestAnimationFrame(u)};requestAnimationFrame(u)}function qt(t){o.clearColor(0,0,0,1),o.clearDepth(1),o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);const a=o.canvas.clientHeight/o.canvas.clientWidth,i=.1,n=100,r=M();wt(r,0,A,0,A*a,i,n);const e=20,f=Math.floor(T.x/2)-1,u=Math.floor(T.z/2)-5;for(let s=u;s<u+y*2;s++){let h=s*20;for(let l=f;l<f+A*2;l++){let p=h+l;!(l>=e)&&!(l<0)&&!(s<0)&&!(s>=e)?z(o,G[p],[l,s],t,r,T.cameraMatrix):z(o,254,[l,s],t,r,T.cameraMatrix)}}}
