var D=Object.defineProperty;var U=(m,c,h)=>c in m?D(m,c,{enumerable:!0,configurable:!0,writable:!0,value:h}):m[c]=h;var b=(m,c,h)=>(U(m,typeof c!="symbol"?c+"":c,h),h);(function(){"use strict";const m=Symbol("Comlink.proxy"),c=Symbol("Comlink.endpoint"),h=Symbol("Comlink.releaseProxy"),w=Symbol("Comlink.thrown"),_=e=>typeof e=="object"&&e!==null||typeof e=="function",R={canHandle:e=>_(e)&&e[m],serialize(e){const{port1:s,port2:u}=new MessageChannel;return S(e,s),[u,[u]]},deserialize(e){return e.start(),z(e)}},T={canHandle:e=>_(e)&&w in e,serialize({value:e}){let s;return e instanceof Error?s={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:s={isError:!1,value:e},[s,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},A=new Map([["proxy",R],["throw",T]]);function S(e,s=self){s.addEventListener("message",function u(t){if(!t||!t.data)return;const{id:n,type:d,path:a}=Object.assign({path:[]},t.data),f=(t.data.argumentList||[]).map(g);let r;try{const l=a.slice(0,-1).reduce((o,y)=>o[y],e),i=a.reduce((o,y)=>o[y],e);switch(d){case"GET":r=i;break;case"SET":l[a.slice(-1)[0]]=g(t.data.value),r=!0;break;case"APPLY":r=i.apply(l,f);break;case"CONSTRUCT":{const o=new i(...f);r=H(o)}break;case"ENDPOINT":{const{port1:o,port2:y}=new MessageChannel;S(e,y),r=O(o,[o])}break;case"RELEASE":r=void 0;break;default:return}}catch(l){r={value:l,[w]:0}}Promise.resolve(r).catch(l=>({value:l,[w]:0})).then(l=>{const[i,o]=P(l);s.postMessage(Object.assign(Object.assign({},i),{id:n}),o),d==="RELEASE"&&(s.removeEventListener("message",u),L(s))})}),s.start&&s.start()}function C(e){return e.constructor.name==="MessagePort"}function L(e){C(e)&&e.close()}function z(e,s){return k(e,[],s)}function E(e){if(e)throw new Error("Proxy has been released and is not useable")}function k(e,s=[],u=function(){}){let t=!1;const n=new Proxy(u,{get(d,a){if(E(t),a===h)return()=>p(e,{type:"RELEASE",path:s.map(f=>f.toString())}).then(()=>{L(e),t=!0});if(a==="then"){if(s.length===0)return{then:()=>n};const f=p(e,{type:"GET",path:s.map(r=>r.toString())}).then(g);return f.then.bind(f)}return k(e,[...s,a])},set(d,a,f){E(t);const[r,l]=P(f);return p(e,{type:"SET",path:[...s,a].map(i=>i.toString()),value:r},l).then(g)},apply(d,a,f){E(t);const r=s[s.length-1];if(r===c)return p(e,{type:"ENDPOINT"}).then(g);if(r==="bind")return k(e,s.slice(0,-1));const[l,i]=x(f);return p(e,{type:"APPLY",path:s.map(o=>o.toString()),argumentList:l},i).then(g)},construct(d,a){E(t);const[f,r]=x(a);return p(e,{type:"CONSTRUCT",path:s.map(l=>l.toString()),argumentList:f},r).then(g)}});return n}function N(e){return Array.prototype.concat.apply([],e)}function x(e){const s=e.map(P);return[s.map(u=>u[0]),N(s.map(u=>u[1]))]}const M=new WeakMap;function O(e,s){return M.set(e,s),e}function H(e){return Object.assign(e,{[m]:!0})}function P(e){for(const[s,u]of A)if(u.canHandle(e)){const[t,n]=u.serialize(e);return[{type:"HANDLER",name:s,value:t},n]}return[{type:"RAW",value:e},M.get(e)||[]]}function g(e){switch(e.type){case"HANDLER":return A.get(e.name).deserialize(e.value);case"RAW":return e.value}}function p(e,s,u){return new Promise(t=>{const n=I();e.addEventListener("message",function d(a){!a.data||!a.data.id||a.data.id!==n||(e.removeEventListener("message",d),t(a.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:n},s),u)})}function I(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class j{constructor(s){b(this,"mapSize");b(this,"_roads",[[!1,!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!1,!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!1,!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]]);b(this,"map",new Uint8Array);b(this,"_cb");this.map=s,this.mapSize=Math.sqrt(s.length)}setTile(s,u,t){const n=u*this.mapSize+s;this.map[n]=t,this._cb(this.map)}_drawRoads(){var s,u;for(let t=0;t<this.mapSize;t++)for(let n=0;n<this.mapSize;n++)if(this._roads[t][n]){let a=0,f=!!((s=this._roads[t-1])==null?void 0:s[n]),r=!!((u=this._roads[t+1])==null?void 0:u[n]),l=!!this._roads[t][n-1],i=!!this._roads[t][n+1];f&&r&&l&&i?a=7:f&&r&&l?a=14:f&&r&&i?a=13:r&&i&&l?a=12:f&&l&&i?a=15:l&&i?a=1:f&&r?a=4:l&&f?a=8:l&&r?a=9:r&&i?a=10:i&&f?a=11:f?a=5:r?a=6:i?a=2:l?a=3:a=16;let o=t*this.mapSize+n;this.map[o]=a}}static log(){console.log("buildings worker running")}setCallback(s){this._cb=s,this._cb(this.map)}}S(j)})();
